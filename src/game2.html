<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ch2BaseFile - Template For Chapter 2 Examples</title>
<script src="modernizr.custom.34365.js"></script>
<script src="jquery2-min.js"></script>
<script type="text/javascript">
	var spriteRes = function(dx,dy,w,h){
		 this.dx = dx;
		 this.dy = dy;
		 this.w  = w;
		 this.h  = h;
	};
	
	var tankRes = new spriteRes(16*33,3*33,33,33);

	var myTank = function(){};
	
	var mouseCaz = {
			init:function(){
				this.gamecanvas = $('#gameCanvas')[0];
			// calculate position of the canvas DOM element on the page

			var canvasPosition = {
				x: this.gamecanvas.offsetParent.offsetLeft,
				y: this.gamecanvas.offsetParent.offsetTop
			};

			this.gamecanvas.onclick = function(e) {

			// use pageX and pageY to get the mouse position
			// relative to the browser window

			var mouse = {
				x: e.pageX - canvasPosition.x,
				y: e.pageY - canvasPosition.y
			};

			// now you have local coordinates,
			// which consider a (0,0) origin at the
			// top-left of canvas element
    		console.log('x:'+mouse.x+'==y:'+mouse.y);
			}
		}
	}
	
window.addEventListener('load', eventWindowLoaded, false);
var context = $('#gameCanvas')[0];
function eventWindowLoaded() {
 	canvasApp();
	mouseCaz.init();
	setInterval(drawScreen,100);
}

//Canvas check(Import from Modernizr)
function canvasSupport () {
	return Modernizr.canvas;
 }
function canvasApp(){
	if (!canvasSupport()) {
	//Assert for Browser Canvas Support
 		return;
}else{
	//init canvas context for all
  	var theCanvas = $('#gameCanvas')[0];
  	var context = theCanvas.getContext("2d");
}


function Render() {
	console.log('Render time');
	var dx = 33;
	var dy = 33;
	var x = 0; 
	var y = 0;
	var sourceDex = 33;
	var counter = 0;
	var tileSheet = new Image();
	tileSheet.addEventListener('load',eventShipLoaded , false);
	tileSheet.src = 'tankbrigade.png';
	function startUp(){
		setInterval(drawScreen,100);
	}
	function eventShipLoaded() {
		startUp(); 
	}
	
	function drawScreen() {
	//draw a background so we can see the Canvas edges 

		context.fillStyle = "#aaaaaa";
		context.fillRect(0,0,23*33,13*33);
               var tileBlockW = 33;
               var tileBlockH = 33;
                var mapRows = 13; 
                var mapCols = 23;
                var sourceX,sourceY = 0;
                var mapIndexOffset = -1;
                var mapTitle = [[78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,55,78,78,78,78],
  [102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,55,102,102,102,102],
  [102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,55,102,102,102,102],
  [102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,55,102,102,102,102],
  [102,102,102,102,102,102,102,102,102,102,102,102,102,102,100,100,100,100,55,102,102,102,102],
  [102,102,102,102,102,102,102,102,102,102,102,102,102,102,100,100,100,100,55,102,102,102,102],
  [102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,55,102,102,102,102],
  [102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,55,102,102,102,102],
  [102,102,100,100,102,102,102,102,102,102,102,102,102,102,102,102,102,102,55,102,102,102,102],
  [102,102,100,100,102,102,102,102,102,102,102,102,102,102,102,102,102,102,55,102,102,102,102],
  [102,102,100,100,102,102,102,102,60,60,60,60,102,102,102,102,102,102,55,102,102,102,102],
  [102,102,102,102,102,102,102,102,60,74,74,60,102,102,102,102,102,102,102,102,102,102,102],
  [102,102,102,102,102,102,102,102,60,74,74,60,102,102,102,102,102,102,102,102,102,102,102]];

  for (var rowCtr=0;rowCtr<mapRows;rowCtr++) { 
            for (var colCtr=0;colCtr<mapCols;colCtr++){						var tileId = mapTitle[rowCtr][colCtr]+mapIndexOffset; 				var sourceX = Math.floor(tileId % 24) * 33;//tmx use line-based count
		var sourceY = Math.floor(tileId / 24) * 33;
		context.drawImage(tileSheet, sourceX,
                sourceY,32,32,colCtr*33,rowCtr*33,32,32);
							} 
					}
	                                                                                        }
	}
 }
</script>
</head>
<body>
<div style="position: absolute; top: 50px; left: 50px;"> <canvas id="gameCanvas" width="800" height="500">
Your browser does not support HTML5 Canvas. </canvas>
</div>
</body>
</html>
